<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>üåç Hospital's data in Bangkok Web Application</title>

    <style>
        html,
        body,
        #viewDiv {
            height: 95%;
            margin: 0;
            padding: 0;
        }

        @font-face {
            font-family: 'ClashDisplay';
            src: url('../fonts/ClashDisplay-Variable.ttf') format('truetype'); 
        }
    </style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />
    <script>
        var esriConfig = {
            apiKey: "AAPTxy8BH1VEsoebNVZXo8HurO6R7OWkb4bmwjG96jGOFdU_21U3bnsNqmypGIpLtr4p8wtJViWhH9AFmTfZ4nogT6Ambby6xilluNLuSXND48A8c5AmIA-1kgjHeIXw84hvF6S4TZOBPR2_2oEpbhVuhBz6mw79zBWcVXlKr8G4FZ84p-VoTmV1_XWtgHspkf6mBj6EzPhQgJcO1zrFhxaz8TMKh7or3NtCPlcy_vJkgMk.AT1_dzEMY6Ea",
        };
    </script>
    <script src="https://js.arcgis.com/4.32/"></script>


    <!-- import methods -->
    <script type="module">
        import { setupToggleButton } from '../method/filter.js';
        window.setupToggleButton = setupToggleButton; // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏ö‡∏ô window ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô require ‡πÑ‡∏î‡πâ
    </script>

</head>

<body>
    <div class="text-xl font-bold p-5 flex justify-between" style="font-family: 'ClashDisplay'"> 
        <div>
            <span style="padding-right:10px;">  üåç  </span>Hospital's data in Bangkok Web Application 
        </div>
        <div class="flex gap-2">
            <button id="search-data-button" class="bg-blue-300 hover:bg-blue-300 text-white font-bold py-1 px-3 rounded-full">üîé search</button>
            <button id="find-route-button" class="bg-gray-900 hover:bg-blue-300 text-white font-bold py-1 px-3 rounded-full">üöó find route</button>
            <button id="edit-data-button" class="bg-gray-900 hover:bg-blue-300 text-white font-bold py-1 px-3 rounded-full">‚úèÔ∏è edit</button>
        </div>
    </div>
    <div id="viewDiv"></div>
    <div
        id="select-by-circle"
        class="esri-widget esri-widget--button esri-widget esri-interactive"
        title="Select features by rectangle"
    >
        <span class="esri-icon-checkbox-unchecked"></span>
    </div>
    <div
        id="clear-selection"
        class="esri-widget esri-widget--button esri-widget esri-interactive"
        title="Clear selection"
    >
        <span class="esri-icon-erase"></span>
    </div>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/WebMap",
            "esri/layers/FeatureLayer",
            "esri/widgets/Search",
            "esri/renderers/HeatmapRenderer",
            "esri/widgets/Editor",
            "esri/widgets/Sketch/SketchViewModel",
            "esri/layers/GraphicsLayer",
            "esri/widgets/Home",
            "esri/widgets/Legend",
            "esri/layers/CSVLayer",
            "esri/widgets/Directions", 
            "esri/layers/RouteLayer",
            "esri/widgets/Compass"
        ], function (
                    Map, 
                    MapView, 
                    WebMap, 
                    FeatureLayer, 
                    Search, 
                    HeatmapRenderer, 
                    Editor, 
                    SketchViewModel,
                    GraphicsLayer,
                    Home,
                    Legend,
                    CSVLayer,
                    Directions,
                    RouteLayer,
                    Compass,
            ) {
            const apiKey = "AAPTxy8BH1VEsoebNVZXo8HurO6R7OWkb4bmwjG96jGOFdU_21U3bnsNqmypGIpLtr4p8wtJViWhH9AFmTfZ4nogT6Ambby6xilluNLuSXND48A8c5AmIA-1kgjHeIXw84hvF6S4TZOBPR2_2oEpbhVuhBz6mw79zBWcVXlKr8G4FZ84p-VoTmV1_XWtgHspkf6mBj6EzPhQgJcO1zrFhxaz8TMKh7or3NtCPlcy_vJkgMk.AT1_dzEMY6Ea";

            const govHospitalHeatmapRenderer = new HeatmapRenderer({
                colorStops: [
                    // ratio: ‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 0 ‡∏ñ‡∏∂‡∏á 1)
                    { color: "rgba(63, 40, 102, 0)", ratio: 0 }, 
                    { color: "#E1ECFF", ratio: 0.083 },
                    { color: "#C4DAFF", ratio: 0.166 },
                    { color: "#ADCCFF", ratio: 0.249 },
                    { color: "#A5C4F5", ratio: 0.332 },
                    { color: "#9EBCED", ratio: 0.415 },
                    { color: "#94B1E0", ratio: 0.498 },
                    { color: "#5271A6", ratio: 0.581 },
                    { color: "#1A3A75", ratio: 0.664 },
                    { color: "#12275A", ratio: 0.747 },
                    { color: "#0D1A48", ratio: 0.83 },
                    { color: "#020024", ratio: 0.913 },
                    { color: "#FFBCBA", ratio: 1 }, // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                ],
                maxDensity: 0.01, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô Heatmap ‡∏Ñ‡∏∑‡∏≠ 0.01 (‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                minDensity: 0, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏Ñ‡πà‡∏≤ 0 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
            });

            const privHospitalHeatmapRenderer = new HeatmapRenderer({
                colorStops: [
                    // ratio: ‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 0 ‡∏ñ‡∏∂‡∏á 1)
                    { color: "rgba(63, 40, 102, 0)", ratio: 0 }, 
                    { color: "#E2B0CE", ratio: 0.083 },
                    { color: "#DBB1D0", ratio: 0.166 },
                    { color: "#D3B2D3", ratio: 0.249 },
                    { color: "#CDB3D5", ratio: 0.332 },
                    { color: "#C7B4D7", ratio: 0.415 },
                    { color: "#C1B5D9", ratio: 0.498 },
                    { color: "#BCB6DB", ratio: 0.581 },
                    { color: "#B3B7DE", ratio: 0.664 },
                    { color: "#ABB8E1", ratio: 0.747 },
                    { color: "#A5B9E3", ratio: 0.83 },
                    { color: "#9FBAE5", ratio: 0.913 },
                    { color: "#372B8A", ratio: 1 }, // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                ],
                maxDensity: 0.01, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô Heatmap ‡∏Ñ‡∏∑‡∏≠ 0.01 (‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                minDensity: 0, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏Ñ‡πà‡∏≤ 0 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
            });

            let govHospitalPinRenderer = {
                type: "class-breaks",
                field: "num_bed",
                classBreakInfos: [
                    {
                        minValue: 401,
                        maxValue: 10000,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/L_G_HospitalIcon.png", 
                            width: "45px",
                            height: "45px"
                        },
                        label: "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 400 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    },
                    {
                        minValue: 151,
                        maxValue: 400,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/M_G_HospitalIcon.png",
                            width: "45px",
                            height: "45px"
                        },
                        label: "151 - 400 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    },
                    {
                        minValue: 1,
                        maxValue: 150,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/S_G_HospitalIcon.png",
                            width: "45px",
                            height: "45px"
                        },
                        label: "1 - 150 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    }
                ]
            };

            let privHospitalPinRenderer = {
                type: "class-breaks",
                field: "num_bed",
                classBreakInfos: [
                    {
                        minValue: 401,
                        maxValue: 10000,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/L_P_HospitalIcon.png", 
                            width: "45px",
                            height: "45px"
                        },
                        label: "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 400 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    },
                    {
                        minValue: 151,
                        maxValue: 400,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/M_P_HospitalIcon.png",
                            width: "45px",
                            height: "45px"
                        },
                        label: "151 - 400 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    },
                    {
                        minValue: 1,
                        maxValue: 150,
                        symbol: {
                            type: "picture-marker",
                            url: "../icon/S_P_HospitalIcon.png",
                            width: "45px",
                            height: "45px"
                        },
                        label: "1 - 150 ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á"
                    }
                ]
            };

            let pharmacyPinRenderer = {
                type: "simple",
                symbol: {
                    type: "picture-marker",
                    url: "../icon/drugs.png", // URL ‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                    width: "20px",
                    height: "20px"
                },
                label: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤"        
            };

            const bangkokDistrictLayer = new FeatureLayer({
                portalItem: {
                    id: "bce116f3ded642eca70f757c8ca44d66",
                },
                outFields: ["*"],
            });

            const pharmacyCSVLayer = new CSVLayer({
                url: "https://pharmacydata.tiiny.site/pharmacy_data.csv",
                latitudeField: "dsLatitude",
                longitudeField: "dsLongitude",
                popupTemplate: {
                    title: "{dsName}",
                    content: `
                    <b>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {dsAddress} <br>
                    <b>üß≠ ‡πÇ‡∏ã‡∏ô:</b> {bkkZone} <br>
                    <b>üó∫Ô∏è ‡πÄ‡∏Ç‡∏ï:</b> {dsDistrict} <br>
                    <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {dsPhone} <br>
                    <img src="https://img.graphicsurf.com/2020/09/people-in-pharmacy-vector-illustration.jpg" alt="Place Image" width="100%">
                `,
                },
                renderer: pharmacyPinRenderer, // Start with heatmap at low zoom levels
            });

            const govHospitalFeatureLayer = new FeatureLayer({
                url: "https://services3.arcgis.com/D5fxuanxFwyX9ohT/arcgis/rest/services/gov_hos/FeatureServer",
                outFields: ["*"],
                popupTemplate: {
                    title: `‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏±‡∏ê - {name}`,
                    content: `
                        <b>üó∫Ô∏è ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {address} <br>
                        <b>üß≠ ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå:</b> {dcode} <br>
                        <b>üèùÔ∏è ‡πÄ‡∏Ç‡∏ï:</b> {dname} <br>
                        <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {tel} <br>
                        <b>üåé ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:</b> <a href="https://{url}" target="_blank">{name}</a> <br>
                        <b>üõå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</b> {num_bed} <br>
                        <b>üè• ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î:</b> {belong} <br>
                        <b>üóÇÔ∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> {type} <br>
                        <img src="https://static.vecteezy.com/system/resources/thumbnails/007/681/899/small/hospital-building-outside-composition-vector.jpg" alt="Hospital Image" width="100%">
                    `,
                },
                renderer: govHospitalPinRenderer,
            });

            const privHospitalFeatureLayer = new FeatureLayer({
                url: "https://services3.arcgis.com/D5fxuanxFwyX9ohT/arcgis/rest/services/priv_hos/FeatureServer",
                outFields: ["*"],
                popupTemplate: {
                    title: `‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô - {name}`,
                    content: `
                        <b>üó∫Ô∏è ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {address} <br>
                        <b>üß≠ ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå:</b> {dcode} <br>
                        <b>üèùÔ∏è ‡πÄ‡∏Ç‡∏ï:</b> {dname} <br>
                        <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {tel} <br>
                        <b>üåé ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:</b> <a href="https://{url}" target="_blank">{name}</a> <br>
                        <b>üõå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</b> {num_bed} <br>
                        <img src="https://static.vecteezy.com/system/resources/thumbnails/007/681/899/small/hospital-building-outside-composition-vector.jpg" alt="Hospital Image" width="100%">
                    `,
                },
                renderer: privHospitalPinRenderer,
            });

            const routeLayer = new RouteLayer();

            const webmap = new WebMap({
                    portalItem: {
                    id: "cf011960a3e140dd9e157788c2b23d68",
                }
            });

            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ webmap ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ add layers ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
            webmap.when(() => {
                webmap.addMany([
                    bangkokDistrictLayer,
                    pharmacyCSVLayer,
                    govHospitalFeatureLayer,
                    privHospitalFeatureLayer,
                    routeLayer,
                ]);
            });

            // üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á View
            const view = new MapView({
                container: "viewDiv",
                map: webmap,
                center: [100.54, 13.75], // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø
                zoom: 13.5,
            });
           
            view.watch("zoom", function (newZoom) {
                if (newZoom >= 13) {
                    govHospitalFeatureLayer.renderer = govHospitalPinRenderer;
                    privHospitalFeatureLayer.renderer = privHospitalPinRenderer;
                } else {
                    govHospitalFeatureLayer.renderer = govHospitalHeatmapRenderer;
                    privHospitalFeatureLayer.renderer = privHospitalHeatmapRenderer;
                }
            });

            const editor = new Editor({
                    view: view,
            });

            view.ui.add(editor, "top-right");
            editor.visible = false;

            const searchWidget = new Search({
            view: view,
            sources: [
                {
                    layer: privHospitalFeatureLayer,
                    name: "‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô",
                    searchFields: ["name", "dname", "dcode"],
                    displayField: "name",
                    exactMatch: false,
                    outFields: ["*"],
                    placeholder: "üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô...",
                    suggestionTemplate: "{name} - {address}",
                    popupTemplate: {
                        title: `‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• {name}`,
                        content: `
                            <b>üó∫Ô∏è ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {address} <br>
                            <b>üß≠ ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå:</b> {dcode} <br>
                            <b>üèùÔ∏è ‡πÄ‡∏Ç‡∏ï:</b> {dname} <br>
                            <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {tel} <br>
                            <b>üåé ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:</b> <a href="https://{url}" target="_blank">{name}</a> <br>
                            <b>üõå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</b> {num_bed} <br>
                        `,
                    },
                },
                {
                    layer: govHospitalFeatureLayer,
                    name: "‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏±‡∏ê",
                    searchFields: ["name", "dname", "dcode"],
                    displayField: "name",
                    exactMatch: false,
                    outFields: ["*"],
                    placeholder: "üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏±‡∏ê...",
                    suggestionTemplate: "{name} - {address}",
                    popupTemplate: {
                        title: `‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• {name}`,
                        content: `
                            <b>üó∫Ô∏è ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {address} <br>
                            <b>üß≠ ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå:</b> {dcode} <br>
                            <b>üèùÔ∏è ‡πÄ‡∏Ç‡∏ï:</b> {dname} <br>
                            <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {tel} <br>
                            <b>üåé ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:</b> <a href="https://{url}" target="_blank">{name}</a> <br>
                            <b>üõå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</b> {num_bed} <br>
                            <b>üè• ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î:</b> {belong} <br>
                            <b>üóÇÔ∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> {type} <br>
                        `,
                    },
                },
                {
                    layer: pharmacyCSVLayer,
                    name: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤",
                    searchFields: ["dsName", "dsDistrict", "dsAddress"],
                    displayField: "dsName",
                    exactMatch: false,
                    outFields: ["*"],
                    placeholder: "üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡πà‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤...",
                    suggestionTemplate: "{dsName} - {dsAddress}",
                    popupTemplate: {
                        title: `‡∏£‡πâ‡πà‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤ {dsName}`,
                        content: `
                            <b>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> {dsAddress} <br>
                            <b>üß≠ ‡πÇ‡∏ã‡∏ô:</b> {bkkZone} <br>
                            <b>üó∫Ô∏è ‡πÄ‡∏Ç‡∏ï:</b> {dsDistrict} <br>
                            <b>‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b> {dsPhone} <br>
                            <img src="https://img.graphicsurf.com/2020/09/people-in-pharmacy-vector-illustration.jpg" alt="Place Image" width="100%">
                        `,
                    },
                }
            ],
            });

            view.ui.add(searchWidget, {
                position: "top-right",
            });

            view.ui.add(
                new Home({
                    view: view
                }),
                "top-left"
            );

            view.ui.add(
                new Compass({
                    view: view
                }),
                "top-left"
            );
       

            view.ui.add(
                new Legend({
                    view: view,
                    style: {
                        type: "card", // other styles include 'classic'
                        layout: "auto" // other layouts include 'stack' and 'side-by-side'
                    }
                }),
                "bottom-left"
            );

            let directionsWidget = new Directions({
                layer: routeLayer,
                apiKey,
                view
            });

            // Add the Directions widget to the top right corner of the view
            view.ui.add(directionsWidget, {
                position: "top-right"
            });
            
            directionsWidget.visible = false;
           
            const targetLayers = [pharmacyCSVLayer,govHospitalFeatureLayer, privHospitalFeatureLayer];

            const drawGraphicsLayer = new GraphicsLayer();
            webmap.add(drawGraphicsLayer);

            // Setup ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ SketchViewModel
            const sketchViewModel = new SketchViewModel({
                view: view,
                layer: drawGraphicsLayer,
            });

            view.ui.add("select-by-circle", "top-left");

            const selectButton = document.getElementById("select-by-circle");

            selectButton.addEventListener("click", () => {
                drawGraphicsLayer.removeAll();
                view.closePopup();
                sketchViewModel.create("circle");
            });

            const clearButton = document.getElementById("clear-selection");
            view.ui.add("clear-selection", "top-left");

            clearButton.addEventListener("click", () => {
                drawGraphicsLayer.removeAll();
                targetLayers.forEach((layer) => {
                    layer.featureEffect = null;
                });
            });

            sketchViewModel.on("create", async (drawData) => {
                if (drawData.state === "complete") {
                    console.log("drawData", drawData.graphic.geometry);
                    
                    targetLayers.forEach((layer) => {
                        layer.featureEffect = {
                            filter:{
                                geometry: drawData.graphic.geometry,
                            },
                            includedEffect: "drop-shadow(3px, 3px, 3px, gray) brightness(1.2)",
                            excludedEffect: "opacity(30%)"
                        }
                    });
                }
            });

            sketchViewModel.on("update", (event) => {
            if (event.state === "active") {
                const updatedGeometry = event.graphics[0].geometry;
                
                targetLayers.forEach((layer) => {
                layer.featureEffect = {
                    filter: {
                    geometry: updatedGeometry,
                    },
                    includedEffect: "drop-shadow(3px, 3px, 3px, gray) brightness(1.2)",
                    excludedEffect: "opacity(30%)"
                };
                });
            }
            });
            
            setupToggleButton("edit-data-button", editor);
            setupToggleButton("search-data-button", searchWidget);
            setupToggleButton("find-route-button", directionsWidget);

        });
        // Ref: https://developers.arcgis.com/javascript/latest/sample-code/layers-featurelayer/
    </script>

</body>

</html>